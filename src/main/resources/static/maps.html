<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<link rel="icon" type="image/png" href="assets/img/favicon.ico">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

	<title>Light Bootstrap Dashboard by Creative Tim</title>

	<meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />


    <!-- Bootstrap core CSS     -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="assets/css/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="assets/css/light-bootstrap-dashboard.css?v=1.4.0" rel="stylesheet"/>


    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="assets/css/demo.css" rel="stylesheet" />


    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="assets/css/pe-icon-7-stroke.css" rel="stylesheet" />
      <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
</head>
<body>

<div class="wrapper">
    <div class="sidebar" data-color="purple" data-image="assets/img/sidebar-5.jpg">

    <!--   you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple" -->


    	<div class="sidebar-wrapper">
            <div class="logo">
                <a href="http://www.creative-tim.com" class="simple-text">
                    Creative Tim
                </a>
            </div>

            <ul class="nav">
                <li>
                    <a href="dashboard.html">
                        <i class="pe-7s-graph"></i>
                        <p>Dashboard</p>
                    </a>
                </li>
                <li>
                    <a href="user.html">
                        <i class="pe-7s-user"></i>
                        <p>User Profile</p>
                    </a>
                </li>
                <li>
                    <a href="table.html">
                        <i class="pe-7s-note2"></i>
                        <p>Reservation List </p>
                    </a>
                </li>
                <li class="active">
                    <a href="reserver.html">
                        <i class="pe-7s-news-paper"></i>
                        <p>Reserver</p>
                    </a>
                </li>
               
                <li>
                    <a href="maps.html">
                        <i class="pe-7s-map-marker"></i>
                        <p>Maps</p>
                    </a>
                </li>
                <li>
                    <a href="notifications.html">
                        <i class="pe-7s-bell"></i>
                        <p>Notifications</p>
                    </a>
            </ul>
    	</div>
    </div>

    <div class="main-panel">
		<nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navigation-example-2">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#">Maps</a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav navbar-left">
                        <li>
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                <i class="fa fa-dashboard"></i>
								<p class="hidden-lg hidden-md">Dashboard</p>
                            </a>
                        </li>
                        <li class="dropdown">
                              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                    <i class="fa fa-globe"></i>
                                    <b class="caret hidden-sm hidden-xs"></b>
                                    <span class="notification hidden-sm hidden-xs">5</span>
									<p class="hidden-lg hidden-md">
										5 Notifications
										<b class="caret"></b>
									</p>
                              </a>
                              <ul class="dropdown-menu">
                                <li><a href="#">Notification 1</a></li>
                                <li><a href="#">Notification 2</a></li>
                                <li><a href="#">Notification 3</a></li>
                                <li><a href="#">Notification 4</a></li>
                                <li><a href="#">Another notification</a></li>
                              </ul>
                        </li>
                        <li>
                           <a href="">
                                <i class="fa fa-search"></i>
								<p class="hidden-lg hidden-md">Search</p>
                            </a>
                        </li>
                    </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                           <a href="">
                               <p>Account</p>
                            </a>
                        </li>
                       
                        <li>
                            <a href="#">
                                <p>Log out</p>
                            </a>
                        </li>
						<li class="separator hidden-lg hidden-md"></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div id="map"></div>

    </div>
</div>


</body>

  <div id="map"></div>
    
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      
      #info {
      text-align: center;
      }
      .checked {
  		color: orange;
	  }
	  #lit{
	  color: green;
	  }
	  #hotelName{
	   font-weight:bold;
	  }
     #km{
	  font-weight:bold;
	  }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>
    
    function setCookie(cname,cvalue,exdays) {
  	  var d = new Date();
  	  d.setTime(d.getTime() + (exdays*24*60*60*1000));
  	  var expires = "expires="+ d.toUTCString();
  	  document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
  	}
    
    function getCookie(cname) {
    	  var name = cname + "=";
    	  var decodedCookie = decodeURIComponent(document.cookie);
    	  var ca = decodedCookie.split(';');
    	 
    	  for(var i = 0; i <ca.length; i++) {
    	    var c = ca[i];
    	    while (c.charAt(0) == ' ') {
    	      c = c.substring(1);
    	    }
    	    if (c.indexOf(name) == 0) {
    	      return c.substring(name.length, c.length);
    	    }
    	  }
    	  return "";
    	}
    
  //recuperation id medecin dans la variable idMedcin
    /*setCookie("med",2, 2);
    var idMedcin= getCookie("med");*/
  
    var hotel;
    
    function intialisation(){
	    $.ajax({
	           type: "GET",
	           url: "http://localhost:8080/getMedecin", //use idMedcin instead of 2
	           type : 'GET',
	           data : 'id=' + 2,
	           success: function(data)
	           {          
	              /*setCookie("hotels",JSON.stringify(data.hotels), 2);
	              setCookie("med",JSON.stringify(data.id), 2);*/
	             hotel=JSON.stringify(data.hotels);
	              //alert("message1"+hotel);
	           }
	         });

    }



</script>
    
   <script>
   
 // var data2= getCookie("hotels");
 
  /*
function all(){	
 alert("message2"+hotel);
	alert("message3"+hotel);}*/
	
  var posdoc;
  var map, infoWindow;
  var data = '[{"id":2,"name":"Hôtel du Lion","latitude":48.833401,"longitude":  2.331943,"rating":4,"beds":9,"idM":null},'+
       '{"id":2,"name":"Hôtel FIAP Jean Monnet","latitude":48.830467,"longitude": 2.338070,"rating":3,"beds":3,"idM":null},'+
        	  '{"id":2,"name":"Hôtel Boulevard Saint-Jacques ","latitude":48.831605, "longitude": 2.339771,"rating":3,"beds":3,"idM":null},'+
        	  '{"id":2,"name":"Hôtel Ibis ","latitude":48.827423, "longitude": 2.321030,"rating":3,"beds":3,"idM":null}]';

  function distance(lat1, lon1, lat2, lon2, unit) {
  	if ((lat1 == lat2) && (lon1 == lon2)) {
  		return 0;
  	}
  	else {
  		var radlat1 = Math.PI * lat1/180;
  		var radlat2 = Math.PI * lat2/180;
  		var theta = lon1-lon2;
  		var radtheta = Math.PI * theta/180;
  		var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
  		if (dist > 1) {
  			dist = 1;
  		}
  		dist = Math.acos(dist);
  		dist = dist * 180/Math.PI;
  		dist = dist * 60 * 1.1515;
  		if (unit=="K") { dist = dist * 1.609344 }
  		if (unit=="N") { dist = dist * 0.8684 }
  		return dist;
  	}
  }
        
        
      /* if(idMedcin=='2')
    	   {*/
          posdoc = {
            lat: 48.837494,  
            lng: 2.338900
          }
    	//}
      var d=[];
      d.push(1.5);
      d.push(1.2);
      d.push(1.4);
      d.push(3.3);
         
      
          var iconBase =
              'https://developers.google.com/maps/documentation/javascript/examples/full/images/';
          var icons = {
        		   
        		    hotel: {
        		      icon: 'http://167.86.108.108:882/hotel-yellow.png'
        		    }
        		  };
       
        function initMap(){
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: posdoc.lat, lng: posdoc.lng },
                zoom: 15
            });
            infoWindow = new google.maps.InfoWindow;
            var point_a = new google.maps.LatLng( 48.837494, 2.338900 );
          
            alert(hotel);
            //obj = JSON.parse(hotel);
            
           obj = JSON.parse(data);
            
            var dis=distance(posdoc.lat, posdoc.lng, obj[0].latitude, obj[0].longitude, "k");
            
            for ($f = 1; $f < obj.length; $f++) 
            {
              if(dis > distance(posdoc.lat, posdoc.lng, obj[$f].latitude, obj[$f].longitude, "k"))
              { 
            	dis=distance(posdoc.lat, posdoc.lng, obj[$f].latitude, obj[$f].longitude, "k");
              }
            }
          
            for ($i = 0; $i < obj.length; $i++) {
                var marker = new google.maps.Marker({ position: { lat: obj[$i].latitude, lng: obj[$i].longitude }, map: map,icon: icons['hotel'].icon });
                var infowincontent = document.createElement('div');
                infowincontent.setAttribute('id', 'info');
                var strong = document.createElement('strong');
                strong.setAttribute('id', 'hotelName');
                strong.textContent = "" + obj[$i].name
                infowincontent.appendChild(strong);
                infowincontent.appendChild(document.createElement('br'));

                var text = document.createElement('text');
                text.setAttribute('id', 'lit');
                text.textContent = obj[$i].beds + " lits disponible";
                infowincontent.appendChild(text);
                infowincontent.appendChild(document.createElement('br'));
                var starsChecked = obj[$i].rating;
                var starsUncheked = 5 - starsChecked;
                for (var s = 0; s < starsChecked; s++) {
                    var star = document.createElement('span');
                    star.setAttribute('class', 'fa fa-star checked');
                    infowincontent.appendChild(star);
                }

                for (var nos = 0; nos < starsUncheked; nos++) {

                    var nostar = document.createElement('span');
                    nostar.setAttribute('class', 'fa fa-star');
                    infowincontent.appendChild(nostar);
                }
                infowincontent.appendChild(document.createElement('br'));
                 
                
                /*var point_b = new google.maps.LatLng( obj[$i].latitude, obj[$i].longitude );
                // Get the distance between the two points in miles
                var distance_miles = getDistanceInMiles( point_a, point_b ); 

                // Show the distance, rounded to 2 decimals
                alert( "The distance between point_a and point_b is: \n\n" + distance_miles.toFixed(2)+" miles" );
                
                // Get distance in miles. The API returns distance in meters, and we can easily convert that with multiplication.
                function getDistanceInMiles( point_a, point_b ) {
                	var distance_in_meters = google.maps.geometry.spherical.computeDistanceBetween( point_a, point_b );
                	return (distance_in_meters * 0.001); // convert meters to miles
                }*/
                
                /*var directionsService = new google.maps.DirectionsService();

                var request = {
                  origin      : 'Hôpital Cochin', // a city, full address, landmark etc
                  destination : obj[$i].name,
                  travelMode  : google.maps.DirectionsTravelMode.DRIVING
                };

                directionsService.route(request, function(response, status) {
                  if ( status == google.maps.DirectionsStatus.OK ) {
                    alert( response.routes[0].legs[0].distance.value ); // the distance in metres
                  }
                  else {
                    // oops, there's no route between these two locations
                    // every time this happens, a kitten dies
                    // so please, ensure your address is formatted properly
                  }
                });*/
                
                /*function GetDrivingDistance($lat1, $lat2, $long1, $long2)
                {
                    $url = "https://maps.googleapis.com/maps/api/distancematrix/json?origins=".$lat1.",".$long1."&destinations=".$lat2.",".$long2."&mode=driving&language=en&key="";
                    $ch = curl_init();
                    curl_setopt($ch, CURLOPT_URL, $url);
                    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
                    curl_setopt($ch, CURLOPT_PROXYPORT, 3128);
                    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0);
                    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, 0);
                    $result = curl_exec($ch);
                    curl_close($ch);
                    $response = json_decode($result, true);
                    $distance = $response['rows'][0]['elements'][0]['distance']['text'];
                    $time = $response['rows'][0]['elements'][0]['duration']['text'];

                    return array('distance' => $distance, 'time' => $time);
                }
                alert(GetDrivingDistance(48.837494 , obj[$i].latitude, 2.338900, obj[$i].longitude));*/
                
                var text = document.createElement('text');
                text.setAttribute('id', 'km');
                text.textContent = "~"+d[$i]+" km loin de vous";
                infowincontent.appendChild(text);
                infowincontent.appendChild(document.createElement('br'));
                
                var link = document.createElement('a');
                link.setAttribute('id', 'link1');
                link.setAttribute('href', 'http://localhost:8080/');
                link.innerHTML = "RESERVER"
                infowincontent.appendChild(link);
                let clone = infowincontent;
                let markkclone = marker;
                markkclone.addListener('click', function () {
                    infoWindow.setContent(clone);
                    infoWindow.open(map, markkclone);
                });
                
              if(dis==distance(posdoc.lat, posdoc.lng, obj[$i].latitude, obj[$i].longitude, "k"))
              {   
            	 infoWindow.setContent(clone);
				 infoWindow.open(map, markkclone);
              }
              
              
            }

            infoWindow.setPosition(posdoc);
            /*infoWindow.setContent('Vous êtes ici');
            infoWindow.open(map);*/
            map.setCenter(posdoc);
            
        }
        
        $.when(intialisation()).then(initMap());

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap&libraries=geometry">
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
  </body>
</html>  
