<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="../assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Hospi-Hotel</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no'
        name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../assets/css/light-bootstrap-dashboard.css?v=2.0.0 " rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="../assets/css/demo.css" rel="stylesheet" />
    <link href="../assets/css/design.css" rel="stylesheet" />
    <script src="assets/js/cookies.js"></script>
    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
        #map {
            height: 100%;
        }

        #info {
            text-align: center;
        }
		#hospital {
            text-align: center;
            color: #1DC7EA
        }
        .checked {
            color: orange;
        }

        #lit {
            color: green;
        }
         #hotelName{
	   font-weight:bold;
	  }
     #km{
	  font-weight:bold;
	  }
        

        /* Optional: Makes the sample page fill the window. */
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        
        .butt{
	    border: 0;
	    padding: 0;
	    display: inline;
	    background: none;
	    color: blue;
		}
		.butt:hover {
		    cursor: pointer;
		}
		
		
    </style>
</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-image="../assets/img/sidebar-5.jpg">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

        Tip 2: you can also add an image using data-image tag
    -->
            <div class="sidebar-wrapper">
                <div class="logo">
                    <a href="#" class="simple-text">
                        Hospi-Hotel
                    </a>
                </div>
                <ul class="nav" id="sideNav">
                    <li class="nav-item active">
                        <a class="nav-link" href="dashboardMed.html">
                            <i class="nc-icon nc-chart-pie-35"></i>
                            <p>Tableau De Bord</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="medecin.html">
                            <i class="nc-icon nc-circle-09"></i>
                            <p>Profile</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="Medreservations.html">
                            <i class="nc-icon nc-notes"></i>
                            <p>Mes Réservations</p>
                        </a>
                    </li>

                    <li>
                        <a class="nav-link" href="reserver.html">
                            <i class="nc-icon nc-atom"></i>
                            <p>Réserver</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="MedNotifications.html">
                            <i class="nc-icon nc-bell-55"></i>
                            <p>Notifications</p>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg " color-on-scroll="500">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#pablo">Tableau De Bord</a>
                    <button href="" class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse"
                        aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end" id="navigation">
                        <ul class="nav navbar-nav mr-auto">
                            <li class="nav-item">
                                <a href="#" class="nav-link" data-toggle="dropdown">
                                    <i class="nc-icon nc-palette"></i>
                                    <span class="d-lg-none">Tableau De Bord</span>
                                </a>
                            </li>
                            <li class="dropdown nav-item">
                                <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                                    <i class="nc-icon nc-planet"></i>
                                    <span class="notification">5</span>
                                    <span class="d-lg-none">Notification</span>
                                </a>
                                <ul class="dropdown-menu">
                                    <a class="dropdown-item" href="#">Notification 1</a>
                                    <a class="dropdown-item" href="#">Notification 2</a>
                                    <a class="dropdown-item" href="#">Notification 3</a>
                                    <a class="dropdown-item" href="#">Notification 4</a>
                                    <a class="dropdown-item" href="#">Another notification</a>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="nc-icon nc-zoom-split"></i>
                                    <span class="d-lg-block">&nbsp;Rechercher</span>
                                </a>
                            </li>
                        </ul>
                        <ul class="navbar-nav ml-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="#pablo">
                                    <span class="no-icon">Compte</span>
                                </a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="http://example.com"
                                    id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false">
                                    <span class="no-icon">Info</span>
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                    <a class="dropdown-item" href="#">Action</a>
                                    <a class="dropdown-item" href="#">Another action</a>
                                    <a class="dropdown-item" href="#">Something</a>
                                    <a class="dropdown-item" href="#">Something else here</a>
                                    <div class="divider"></div>
                                    <a class="dropdown-item" href="#">Separated link</a>
                                </div>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="deconnexion" onclick="deleteAllCookies()">
                                    <span class="no-icon">Se Déconnecter</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="map-container">
                <div id="map"></div>
            </div>
            
        </div>
    </div>

    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
   var hotel;
    
    function intialisation(){
	    $.ajax({
	           type: "GET",
	           url: "http://localhost:8080/getListHotelsByIdMed", //use idMedcin instead of 2
	           type : 'GET',
	           data : 'id=' + JSON.parse(getCookieByName("userInfo")).id,
	           success: function(data)
	           {          
	              /*setCookie("hotels",JSON.stringify(data.hotels), 2);
	              setCookie("med",JSON.stringify(data.id), 2);*/
	             hotel=JSON.stringify(data);
	             // alert("message1"+hotel);
	           },
	    error: function (jqXHR, status, err) {
	        alert("une erreur c'est produit réessayer");
	      }
	         });
    }


</script>
    
   <script>
 
 /* var data2= getCookie("hotels");
  var data3= getCookie("med");*/
  var posdoc;
  var map, infoWindow;
  var data = '[{"id":2,"name":"Hôtel du Lion","latitude":48.833401,"longitude":  2.331943,"rating":4,"beds":9,"idM":null},'+
  '{"id":2,"name":"Hôtel FIAP Jean Monnet","latitude":48.830467,"longitude": 2.338070,"rating":3,"beds":3,"idM":null},'+
  '{"id":2,"name":"Hôtel de Massa","latitude":48.836269, "longitude": 2.337639,"rating":3,"beds":3,"idM":null},'+
  '{"id":2,"name":"Seven Hotel","latitude":48.838971,"longitude": 2.345647,"rating":4,"beds":3,"idM":null},'+
   	  '{"id":2,"name":"Hôtel Boulevard Saint-Jacques ","latitude":48.831605, "longitude": 2.339771,"rating":3,"beds":3,"idM":null},'+
   	  '{"id":2,"name":"Hôtel Ibis ","latitude":48.827423, "longitude": 2.321030,"rating":3,"beds":3,"idM":null}]';
        
  function distance(lat1, lon1, lat2, lon2, unit) {
  	if ((lat1 == lat2) && (lon1 == lon2)) {
  		return 0;
  	}
  	else {
  		var radlat1 = Math.PI * lat1/180;
  		var radlat2 = Math.PI * lat2/180;
  		var theta = lon1-lon2;
  		var radtheta = Math.PI * theta/180;
  		var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
  		if (dist > 1) {
  			dist = 1;
  		}
  		dist = Math.acos(dist);
  		dist = dist * 180/Math.PI;
  		dist = dist * 60 * 1.1515;
  		if (unit=="K") { dist = dist * 1.609344 }
  		if (unit=="N") { dist = dist * 0.8684 }
  		return dist;
  	}
  }
        
       // obj2 = JSON.parse(data3); 
       /*if(data3=='2')
    	   {*/
         posdoc = {
            lat: 48.837494,  
            lng: 2.338900
          }
    	//}
      var d=[];
      d.push(1.5);
      d.push(1.2);
      d.push(1.4);
      d.push(3.3);
    	
      
      var icons = {
    		   
    		    hotel: {
    		      icon: 'http://167.86.108.108:882/hotel-yellow.png'
    		    }
    		  };
      
      if(hotel== null)
      {
    	  intialisation();
      }
      
      try {
    	  intialisation();
    	}
    	catch(err) {
    		alert("une erreur c'est produit réessayer");
    	}
      
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: posdoc.lat, lng: posdoc.lng },
                zoom: 15
            });
            infoWindow = new google.maps.InfoWindow;

            obj = JSON.parse(hotel);
            var dis=distance(posdoc.lat, posdoc.lng, obj[0].latitude, obj[0].longitude, "k");
            
            for ($f = 1; $f < obj.length; $f++) 
            {
              if(dis > distance(posdoc.lat, posdoc.lng, obj[$f].latitude, obj[$f].longitude, "k"))
              { 
            	dis=distance(posdoc.lat, posdoc.lng, obj[$f].latitude, obj[$f].longitude, "k");
              }
            }
          
            for ($i = 0; $i < obj.length; $i++) {
                var marker = new google.maps.Marker({ position: { lat: obj[$i].latitude, lng: obj[$i].longitude }, map: map });
                var infowincontent = document.createElement('div');
                infowincontent.setAttribute('id', 'info');
                var strong = document.createElement('strong');
                strong.setAttribute('id', 'hotelName');
                strong.textContent = "" + obj[$i].name
                infowincontent.appendChild(strong);
                infowincontent.appendChild(document.createElement('br'));

                var text = document.createElement('text');
                text.setAttribute('id', 'lit');
                text.textContent = obj[$i].beds + " lits disponible";
                infowincontent.appendChild(text);
                infowincontent.appendChild(document.createElement('br'));
                var starsChecked = obj[$i].rating;
                var starsUncheked = 5 - starsChecked;
                for (var s = 0; s < starsChecked; s++) {
                    var star = document.createElement('span');
                    star.setAttribute('class', 'fa fa-star checked');
                    infowincontent.appendChild(star);
                }

                for (var nos = 0; nos < starsUncheked; nos++) {

                    var nostar = document.createElement('span');
                    nostar.setAttribute('class', 'fa fa-star');
                    infowincontent.appendChild(nostar);
                }
                infowincontent.appendChild(document.createElement('br'));

                var text = document.createElement('text');
                text.setAttribute('id', 'km');
                text.textContent = "~"+d[$i]+" km loin de vous";
                infowincontent.appendChild(text);
                infowincontent.appendChild(document.createElement('br'));
                
                var link=document.createElement('a');
				var param=encodeURIComponent(obj[$i].name);
				var url="reserver.html?hotelName="+param;
				link.setAttribute('href',url);
				link.innerHTML="RESERVER";
				infowincontent.appendChild(link);
                let clone = infowincontent;
                let markkclone = marker;
                markkclone.addListener('click', function () {
                    infoWindow.setContent(clone);
                    infoWindow.open(map, markkclone);
                });
                
              if(dis==distance(posdoc.lat, posdoc.lng, obj[$i].latitude, obj[$i].longitude, "k"))
              {   
            	 infoWindow.setContent(clone);
				 infoWindow.open(map, markkclone);
              }
            }
            
   var hospital = new google.maps.Marker({ position: { lat: posdoc.lat, lng: posdoc.lng }, map: map,icon: icons['hotel'].icon });
   infoWindow2 = new google.maps.InfoWindow;
            infoWindow2.setPosition(posdoc);  
            var infowincontent2 = document.createElement('div');
            infowincontent2.setAttribute('id', 'hospital');
            var strong = document.createElement('strong');
            strong.setAttribute('id', 'hotelName');
            strong.textContent = 'Hôpital Cochin'
            infowincontent2.appendChild(strong);
            infoWindow2.setContent(infowincontent2);
            infoWindow2.open(map,hospital);
            map.setCenter(posdoc);
            hospital.addListener('click', function () {
            	 
                infoWindow2.setContent(infowincontent2);
                infoWindow2.open(map, hospital);
            });
        }
        
       $.when(intialisation()).then(initMap());
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap">
    </script>
</body>
<!--   Core JS Files   -->
<script src="../assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="../assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="../assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="../assets/js/plugins/bootstrap-switch.js"></script>
<!--  Google Maps Plugin    -->

<!--  Chartist Plugin  -->
<script src="../assets/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    
<script src="../assets/js/plugins/bootstrap-notify.js"></script> -->
<!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
<script src="../assets/js/light-bootstrap-dashboard.js?v=2.0.0 " type="text/javascript"></script>
<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
<script src="../assets/js/demo.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        // Javascript method's body can be found in assets/js/demos.js
        demo.initDashboardPageCharts();

        demo.showNotification();

    });
</script>

</html>